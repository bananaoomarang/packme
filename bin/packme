#!/usr/bin/env node

var Path     = require('path');
var Fs       = require('fs');
var Bluebird = require('bluebird');

Bluebird.promisifyAll(Fs);

var argv = require('yargs')
  .usage('Usage: packme <package> <infrom> <outto>')
  .demand(3)
  .argv;

var package = argv._[0];
var infrom  = argv._[1];
var outto   = argv._[2];

var pkgdir  = Path.join(process.cwd(), package);

var _in = require(Path.join('../ins',  infrom))
var out = require(Path.join('../outs', outto));

_in(package)
  .then(out)
  .then(function (result) {
      return Bluebird.all(
          Object
              .keys(result)
              .map(function (key) {
                  return Fs.writeFileAsync(key, result[key]);
              })
      );
  });
